<!DOCTYPE html>
<html lang="es-es">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<title>
			Novedades de c# 9 · developerro
		</title>
		<!-- Social Metas -->
		<meta name="description" content="Este a&#241;o 2020 est&#225; siendo como una monta&#241;a rusa. Y el mundo de las tecnolog&#237;as de desarrollo de Microsoft no iba a ser diferente. En noviembre se espera la p..." />
		<meta property="og:title" content="Novedades de c# 9" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://www.developerro.com/2020/08/19/csharp-9" />
		<meta property="og:image" content="https://www.developerro.com/assets/uploads/bg/programming2.jpg" />
		<meta property="og:description" content="Este año 2020 está siendo como una montaña rusa. Y el mundo de las tecnologías de desarrollo de Microsoft no iba a ser diferente. En noviembre se espera la p..." />
		<meta property="og:site_name" content="developerro" />
		<meta property="og:locale" content="es_es" />
		<meta property="article:modified_time" content="2020-08-19 01:22:31Z" />
		<meta property="article:published_time" content="2020-08-19 01:22:31Z" />
		<meta property="article:author" content="Fernando Escolar" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/24/azure-functions-net-5" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/10/efcore-vs-records" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/03/chorra-tip-1-wcd-command" />
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@fernandoescolar" />
		<meta name="twitter:creator" content="@fernandoescolar" />
		<meta name="twitter:title" content="Novedades de c# 9" />
		<meta name="twitter:description" content="Este año 2020 está siendo como una montaña rusa. Y el mundo de las tecnologías de desarrollo de Microsoft no iba a ser diferente. En noviembre se espera la p..." />
		<meta name="twitter:image" content="https://www.developerro.com/assets/uploads/bg/programming2.jpg" />
		<meta name="twitter:url" content="https://www.developerro.com/2020/08/19/csharp-9" />
		<meta name="description" content="Este año 2020 está siendo como una montaña rusa. Y el mundo de las tecnologías de desarrollo de Microsoft no iba a ser diferente. En noviembre se espera la p..." />
		<link rel="alternate" type="application/atom+xml" title="Developerro" href="/atom.xml" />
		<link rel="canonical" href="https://www.developerro.com/2020/08/19/csharp-9" />
		<!-- Icons -->
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png" />
		<link rel="shortcut icon" href="/assets/favicon.ico" />
		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="Developerro" href="/atom.xml" />
		<!-- Styles -->
		<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" type="text/css" />
		<link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css" />
		<link rel="stylesheet" href="/assets/main.css" />
		<link rel="stylesheet" href="/assets/syntax.css" />
		<!-- Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163390000-1">
		</script>
		<script>
			
			    function activateGoogleAnalytics() {
			        window.dataLayer = window.dataLayer || [];
			        function gtag(){dataLayer.push(arguments);}
			        gtag('js', new Date());
			        gtag('config', 'UA-163390000-1');
			    }
			
		</script>
		<style>
			
			    header { background: linear-gradient(to bottom, rgba(228, 225, 216, 0.95) 0%, rgba(172, 65, 66, 0.55) 100%), url(/assets/uploads/bg/programming2.jpg) center / cover; }
			  
		</style>
	</head>
	<body>
		<nav>
			<i id="hamburger">
			</i> <a href="/">
				<b>
					d</b>eveloperro
			</a>
			<ul>
				<li>
					<a href="/posts">blog
					</a>
				</li>
				<li>
					<a href="/about">
						acerca de
					</a>
				</li>
				<li>
					<a href="/archive">
						archivo
					</a>
				</li>
				<li>
					<a href="/projects">
						oss
					</a>
				</li>
				<li>
					<a href="/search">
						buscar
					</a>
				</li>
				<li>
					<a href="/videos">
						vídeos
					</a>
				</li>
			</ul>
		</nav>
		<header class="post">
			<h1>
				Novedades de c# 9
			</h1><small>19 ago. 2020 · 12 min. de lectura
			</small>
		</header>
		<article class="post">
			<p>
				Este año 2020 está siendo como una montaña rusa. Y el mundo de las tecnologías de desarrollo de Microsoft no iba a ser diferente. En noviembre se espera la presentación de <strong>.Net 5 - <em>A unified platform</em>
				</strong>. No, no es el título de una película de sábado por la tarde de antena 3. Es la nueva plataforma para gobernarlas a todas. Una plataforma para encontrarlas, una plataforma para atraerlas a todas y atarlas en las tinieblas.
				<!--break-->
			</p>
			<p>
				<img src="/assets/uploads/2020/08/net5-ecosystem.png" alt=".Net 2019 vs. 2020" />
			</p>
			<p>
				Pero eso de que junten todos los frameworks en uno, simplifiquen su nombre a <em>.Net
				</em> y le den una versión con rima graciosa, no es lo que importa en realidad. Lo que más nos excita es que a <strong>.Net 5
				</strong> le acompaña una nueva versión de su lenguaje insignia. Hoy os presentamos las novedades de <strong>C# 9
				</strong> y sus notas según la <em>escala sexi-loca
				</em>.
			</p>
			<p>
				<img src="/assets/uploads/2016/11/hot_crazy.jpg" alt="escala sexy loca" />
			</p>
			<p>
				Las normas son las de siempre: eje vertical es lo útil que nos resulta y el eje horizontal la locura de su implementación. Y el objetivo de cada característica es estar por encima de <em>la diagonal Vicky Mendoza
				</em> (x=y) para poder considerarse una buena característica.
			</p>
			<p>
				Y antes de que empecéis a juzgar las notas de cada una de las <em>features
				</em>, comentar que el proceso de asignación de este año ha sido rigurosamente objetivo: hemos desempolvado los dados de <em>El Señor de los Anillos, el juego de rol de la Tierra Media
				</em> y los hemos lanzado 3 veces cada uno. Después hemos calculado la mediana. Y para terminar se le ha aplicado un factor de corrección <em>delta
				</em>. A prueba de todo error.
			</p>
			<p>
				¡Al turrón!
			</p>
			<blockquote>
				<p>
					Como cada año, añadir que algunas de estas funcionalidades no llegarán a aparecer y otras podrían llegar a publicarse, pero de una forma diferente a la que aquí exponemos.
				</p>
			</blockquote>
			<h2 id="init-only-properties">
				Init-only properties
			</h2>
			<p>
				Cuántas veces habremos tenido un error de compilación por meter un objeto como readonly en el constructor y quererlo asignar en otro momento por primera y única vez. La verdad es que no muchas, pero si algunas. Y esto ya justifica esta funcionalidad.
			</p>
			<p>
				Cojamos como ejemplo este código:
			</p>
			<pre class="language-csharp highlight">
<code>public class Place
{
  public string Name { get; set; }
  public string Founder { get; set; }
}

var p = new Place
{
  Name = "Mordor",
  Founder = "Sauron"
};

p.Name = "Moria";
				</code>
</pre>
			<p>
				Ahora cambiemos el <code>set
				</code> de las propiedades por un <code>init
				</code> y tendremos un objeto inmutable:
			</p>
			<pre class="language-csharp highlight">
<code>public class Place
{
  public string Name { get; init; }
  public string Founder { get; init; }
}

var p = new Place
{
  Name = "Mordor",
  Founder = "Sauron"
};

p.Name = "Moria"; // Error
				</code>
</pre>
			<p>
				Es genial la inmutabilidad, ¿verdad?
			</p>
			<p>
				Y si os estáis preguntando como se lleva el <code>init
				</code> con las propiedades readonly, os diré que la mar de bien:
			</p>
			<pre class="language-csharp highlight">
<code>public class Place
{
  private readonly string _name;
  private readonly string _founder;

  public string Name
  {
    get => _name;
    init => _name = (value ?? throw new ArgumentNullException(nameof(Name)));
  }

  public string Founder
  {
    get => _founder;
    init => _founder = (value ?? throw new ArgumentNullException(nameof(Founder)));
  }
}
				</code>
</pre>
			<p>
				Esta funcionalidad puede parecer trivial. Pero abrir la opción a objetos inmutables de una forma sencilla y evitar ciertos errores con los <code>readonly
				</code> está muy bien.
			</p>
			<blockquote>
				<p>
					<b>
						Valoración
					</b>:
				</p>
				<p>
					Useful = <b>7
					</b>
				</p>
				<p>
					Crazy = <b>2
					</b>
				</p>
			</blockquote>
			<h2 id="records">
				Records
			</h2>
			<p>
				Un <code>record
				</code> es un nuevo tipo especial, cuyo origen podemos encontrar en el lenguaje F#, que está basado en una <code>class
				</code> de C# y hereda sus características.
			</p>
			<pre class="language-csharp highlight">
<code>public record Place
{
  public string Name { get; set; }
  public string Founder { get; set; }
}
				</code>
</pre>
			<p>
				Podríamos crear un <code>record
				</code> inmutable, con su constructor y su método de deconstrucción:
			</p>
			<pre class="language-csharp highlight">
<code>public record Place
{
  public string Name { get; init; }
  public string Founder { get; init; }

  public Place(string name, string founder)
    => (Name, Founder) = (name, founder);

  public void Deconstruct(out string name, out int founder)
    => (name, founder) = (Name, Founder);
}
				</code>
</pre>
			<p>
				O definirlo como un <code>record
				</code> de tipo posicional:
			</p>
			<pre class="language-csharp highlight">
<code>public record Place(string Name, string Founder);
				</code>
</pre>
			<p>
				Esto dos últimos ejemplos nos permitirán realizar operaciones de construcción y deconstrucción:
			</p>
			<pre class="language-csharp highlight">
<code>var place = new Place("Mordor", "Sauron");
var (name, founder) = place;
				</code>
</pre>
			<p>
				Además, los tipos <code>record
				</code> admiten herencia:
			</p>
			<pre class="language-csharp highlight">
<code>public record NamedRecord(string Name);
public record Place(string Name, string Founder) : NamedRecord(Name);
				</code>
</pre>
			<p>
				Y añaden nuevos usos a la palabra clave <code>with
				</code>:
			</p>
			<pre class="language-csharp highlight">
<code>var place = new Place("Mordor", "Sauron");
var otherPlace = place with { Name = "Barad-dûr" };
				</code>
</pre>
			<p>
				Aquí se crearía un nuevo <code>record
				</code> como una copia de <code>place
				</code> y se cambiaría la propiedad <code>Name
				</code>. Una sintaxis muy cómoda que seguro que nos trae más opciones en el futuro.
			</p>
			<p>
				Si queréis profundizar más en esta <em>feature
				</em> os recomiendo una lectura de <a href="https://www.eiximenis.dev/posts/2020-07-01-csharp9-records/">un artículo sobre <em>records</em>
				</a> que escribió <a href="https://twitter.com/eiximenis/">Eduard Tomàs
				</a> en su blog.
			</p>
			<p>
				De cualquier forma, consideramos que esto de los <em>records
				</em> es la <em>funcionalidad estrella
				</em> de esta versión 9 de C#. Y creemos que va a ser tan útil como loco puede resultar el hacer tanta magia por detrás usando una palabra clave nueva.
			</p>
			<blockquote>
				<p>
					<b>
						Valoración
					</b>:
				</p>
				<p>
					Useful = <b>9
					</b>
				</p>
				<p>
					Crazy = <b>8
					</b>
				</p>
			</blockquote>
			<h2 id="pattern-matching">
				Pattern matching
			</h2>
			<p>
				En la versión 8 de C# ya pudimos ver <a href="/2019/02/19/csharp-8/#switch-expressions">un gran avance en el <em>Pattern matching</em>
				</a>. En esta nueva entrega sigue mejorando.
			</p>
			<p>
				Lo que podríamos definir con las características de C# 8 como:
			</p>
			<pre class="language-csharp highlight">
<code>string SayPopulation(object place) =>
  place switch
  {
    Place t when t.Population > 1000000 => "Great orc horde",
    Place t when t.Population <= 1000000 && t.Population >= 100000 => "Orc horde",
    Place t when t.Population < 100000 && t.Population >= 100 => "A few orcs",
    Place _ => "Orcs",

    _ => throw new ArgumentException("Not a known place type", nameof(place))
  };
				</code>
</pre>
			<p>
				Ahora queda simplificado por el uso de nuevas palabras clave como <code>and
				</code> y <code>or
				</code>:
			</p>
			<pre class="language-csharp highlight">
<code>string SayPopulation(object place) =>
  place switch
  {
    Place t => t.Population switch
    {
      > 1000000        => "Great orc horde",
      <= 1000000 and >= 100000 => "Orc horde",
      < 100000   and >= 100  => "A few orcs",
                   _ => "Orcs"
    },
    not null => throw new ArgumentException("Not a known place type", nameof(place)),
    null   => throw new ArgumentNullException(nameof(place))
  };
				</code>
</pre>
			<p>
				Además, se ha añadido la comparación a <code>null
				</code> y la <code>not null
				</code>. Esta última nos vendrá muy bien la hora de realizar comparaciones de tipo:
			</p>
			<pre class="language-csharp highlight">
<code>if (!(e is Customer)) { ... } // old
if (e is not Customer) { ... } // C# 9
				</code>
</pre>
			<p>
				Una evolución que viene siguiendo la línea de simplificar la sintaxis y que ayudará a tener un código más claro.
			</p>
			<blockquote>
				<p>
					<b>
						Valoración
					</b>:
				</p>
				<p>
					Useful = <b>8
					</b>
				</p>
				<p>
					Crazy = <b>3
					</b>
				</p>
			</blockquote>
			<h2 id="target-typing">
				Target typing
			</h2>
			<p>
				Si ya tenemos el tipo, no tendremos que volver a repetirlo cuando hagamos un <code>new
				</code>:
			</p>
			<pre class="language-csharp highlight">
<code>Place p = new ("Mordor", "Sauron");
				</code>
</pre>
			<p>
				Y usando ternarios tipo <code>?
				</code> o <code>??
				</code> ahora ya no tendremos que hacer <em>casting
				</em> de objetos con una base comun o del <code>null
				</code>:
			</p>
			<pre class="language-csharp highlight">
<code>Person person = student ?? customer; // Shared base type
int? result = b ? 0 : null; // nullable value type
				</code>
</pre>
			<p>
				Esta última opción me parece que ayudará muchísimo, porque muchas veces terminas haciendo un <em>casting
				</em> en un ternario, que lo ensucia bastante y hace que pierda claridad. La mayor parte de las veces que lo hago, termino metiendo un bloque <code>if
				</code> para que no quede una línea tipo churro. Pero con esta nueva <em>feature
				</em> quedará perfecto.
			</p>
			<blockquote>
				<p>
					<b>
						Valoración
					</b>:
				</p>
				<p>
					Useful = <b>7
					</b>
				</p>
				<p>
					Crazy = <b>1
					</b>
				</p>
			</blockquote>
			<h2 id="covariant-returns">
				Covariant returns
			</h2>
			<p>
				La contravarianza habilita la conversión de referencias implícita de tipos base. Esto implica que podamos crear una clase con un método y otra derivaba con la sobreescritura de ese método, pero usando un objeto de retorno hijo:
			</p>
			<pre class="language-csharp highlight">
<code>abstract class Animal
{
  public abstract Food GetFood();

}
class Tiger : Animal
{
  public override Meat GetFood() => ...;
}
				</code>
</pre>
			<p>
				Esto nos parece muy loco, porque es un cambio innocuo que aportará poco valor a la hora de la verdad. Y lo que es más importante, ya podemos reproducir este comportamiento actualmente:
			</p>
			<pre class="language-csharp highlight">
<code>abstract class Animal
{
  public abstract Food GetFood();

}
class Tiger : Animal
{
  public override Food GetFood() => new Meat(...);
}
				</code>
</pre>
			<p>
				Así que las valoraciones en este caso van a ser un poco duras.
			</p>
			<blockquote>
				<p>
					<b>
						Valoración
					</b>:
				</p>
				<p>
					Useful = <b>1
					</b>
				</p>
				<p>
					Crazy = <b>9
					</b>
				</p>
			</blockquote>
			<h2 id="top-level-programs">
				Top-level programs
			</h2>
			<p>
				Cuando queremos crear un programa simple de consola como un <code>ola k ase
				</code>, en C# tenemos que escribir un montón de movidas absurdas que no ayudan nada. Cosas como una clase o un método estático llamado <code>Main
				</code>:
			</p>
			<pre class="language-csharp highlight">
<code>using System;

class Program
{
  static void Main()
  {
    Console.WriteLine("ola k ase");
  }
}
				</code>
</pre>
			<p>
				Pues esto se acabó. Ahora podemos ponernos a escribir directamente nuestro programa de consola, como si esto fuera <em>node
				</em> con <em>javascript
				</em>:
			</p>
			<pre class="language-csharp highlight">
<code>using System;

Console.WriteLine("ola k ase");
				</code>
</pre>
			<p>
				Y además nos han solucionado la vida. Esta <em>feature
				</em> nos permite aceptar casi cualquier sentencia, como el <code>using
				</code> o un <code>await
				</code>. Y lo que es mejor, si necesitas los parámetros de entrada, existe una variable llamada <code>args
				</code> donde por arte de magia los encontrarás.
			</p>
			<p>
				Bajo nuestro punto de vista, si esta característica no va vinculada a una suerte de C# Script, no aporta demasiado a nuestro código.
			</p>
			<blockquote>
				<p>
					<b>
						Valoración
					</b>:
				</p>
				<p>
					Useful = <b>2
					</b>
				</p>
				<p>
					Crazy = <b>8
					</b>
				</p>
			</blockquote>
			<h2 id="conclusiones">
				Conclusiones
			</h2>
			<p>
				Hemos podido ir jugando con la mayoría de estas features y la verdad es que el protagonista es el nuevo tipo <code>record
				</code>. Puede ser que debamos empezar a normalizar su uso desde ya mismo, porque parece ser que ha venido a quedarse. Es una suerte de implementación ya medio formada, tipo syntax sugar, muy estética y que nos va a ayudar mucho en nuestro día a día. Y quizá no solo a nivel de tratamiento de datos... si no, al tiempo.
			</p>
			<p>
				Sobre el resto de características, consideramos que representan una buena evolución sobre lo ya existente. Y como es habitual, alguna ida de olla también nos podemos encontrar.
			</p>
			<p>
				Los gráficos resumen son los siguientes:
			</p>
			<p>
				<img src="/assets/uploads/2020/08/csharp-9-chart-1.png" alt="resultados escala sexy-loca" />
			</p>
			<p>
				Y dividiendo por <em>la diagonal Vicky Mendoza
				</em>:
			</p>
			<p>
				<img src="/assets/uploads/2020/08/csharp-9-chart-2.png" alt="valor según Diagonal Vicky Mendoza" />
			</p>
			<p>
				Parece ser que este año tenemos más aprobados que suspensos. O quizá es porque estoy escribiendo esto de vacaciones y me encuentro magnánimo.
			</p>
			<h3 id="pruebalo-tu-mismo">
				Pruébalo tú mismo
			</h3>
			<p>
				Podéis probar todo esto siguiendo estos pasos:
			</p>
			<ol>
				<li>
					Descargar e instalar [LINQPad6](<a href="https://www.linqpad.net/LINQPad6.aspx">https://www.linqpad.net/LINQPad6.aspx
					</a>
				</li>
				<li>
					Abrir la aplicación.
				</li>
				<li>
					En el menú dirigirse a <em>Edit
					</em> > <em>Preferences
					</em>.
				</li>
				<li>
					En la ventana que aparece hay que seleccionar el <em>Tab
					</em> llamado <em>Query
					</em>.
				</li>
				<li>
					Marcad la opción de <em>use Roslyn Daily build for experimental C# 9 support
					</em>.
				</li>
			</ol>
			<p>
				<img src="/assets/uploads/2020/08/linqpad6-roslyn-config.png" alt="Configuración de LINQPad6" />
			</p>
		</article>
		<section id="share">
			<a href="https://twitter.com/intent/tweet?text=Novedades de c# 9&url=https://www.developerro.com/2020/08/19/csharp-9" rel="nofollow" target="_blank" title="Share on Twitter">
				<i class="fab fa-twitter">
				</i>
			</a> <a href="https://facebook.com/sharer.php?u=https://www.developerro.com/2020/08/19/csharp-9" rel="nofollow" target="_blank" title="Share on Facebook">
				<i class="fab fa-facebook"></i>
			</a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.developerro.com/2020/08/19/csharp-9" rel="nofollow" target="_blank" title="Share on Linkedlin">
				<i class="fab fa-linkedin"></i>
			</a> <a href="http://www.reddit.com/submit?url=https://www.developerro.com/2020/08/19/csharp-9" rel="nofollow" target="_blank" title="Share on Reddit">
				<i class="fab fa-reddit"></i>
			</a> <a href="https://www.buymeacoffee.com/fernandoescolar" rel="nofollow" target="_blank" title="Buy me a beer">
				<i class="fa fa-beer"></i> buy me a beer
			</a>
		</section>
		<section id="related">
			<h2>
				Relacionado (o no)
			</h2>
			<ul>
				<li>
					<a href="/video/2020/12/09/net-5-just-talking">
						.Net 5 Just Talking
					</a> <small>09 dic. 2020
					</small>
				</li>
				<li>
					<a href="/2019/02/19/csharp-8">
						Novedades de c# 8
					</a> <small>19 feb. 2019
					</small>
				</li>
				<li>
					<a href="/2016/11/16/csharp-7">
						Novedades de c# 7
					</a> <small>16 nov. 2016
					</small>
				</li>
				<li>
					<a href="/2021/03/24/azure-functions-net-5">
						Azure Functions con .NET 5
					</a> <small>24 mar. 2021
					</small>
				</li>
				<li>
					<a href="/2021/03/10/efcore-vs-records">
						EF Core vs. Records
					</a> <small>10 mar. 2021
					</small>
				</li>
			</ul>
		</section>
		<footer>
			<ul>
				<li>
					<a href="mailto:fer.escolar@gmail.com" target="_blank">
						<i class="far fa-envelope">
						</i>
					</a>
				</li>
				<li>
					<a href="https://twitter.com/fernandoescolar" target="_blank">
						<i class="fab fa-twitter">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.linkedin.com/in/fernandoescolar" target="_blank">
						<i class="fab fa-linkedin">
						</i>
					</a>
				</li>
				<li>
					<a href="https://github.com/fernandoescolar" target="_blank">
						<i class="fab fa-github">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.buymeacoffee.com/fernandoescolar" target="_blank">
						<i class="fa fa-beer">
						</i>
					</a>
				</li>
			</ul><a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">
				<img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
			</a>
		</footer>
		<dialog id="cookie-notice">
			Nos gustaría usar cookies de terceros para hacer este sitio mejor. <a id="cookie-notice-accept">vale
			</a>
		</dialog>
		<script src="/assets/scripts.js">
		</script>
	</body>
</html>