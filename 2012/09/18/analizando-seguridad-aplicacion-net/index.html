<!DOCTYPE html>
<html lang="es-es">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<title>
			Analizando la seguridad de una aplicación en .net · developerro
		</title>
		<!-- Social Metas -->
		<meta name="description" content="Se han escrito muchas l&#237;neas acerca de la seguridad de las aplicaciones que realizamos en .Net. Se dice que son muy f&#225;ciles de hackear, que aun usando herram..." />
		<meta property="og:title" content="Analizando la seguridad de una aplicación en .net
" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://www.developerro.com/2012/09/18/analizando-seguridad-aplicacion-net" />
		<meta property="og:image" content="https://www.developerro.com/assets/apple-touch-icon-144-precomposed.png" />
		<meta property="og:description" content="Se han escrito muchas líneas acerca de la seguridad de las aplicaciones que realizamos en .Net. Se dice que son muy fáciles de hackear, que aun usando herram..." />
		<meta property="og:site_name" content="developerro" />
		<meta property="og:locale" content="es_es" />
		<meta property="article:modified_time" content="2012-09-18 09:15:52Z" />
		<meta property="article:published_time" content="2012-09-18 09:15:52Z" />
		<meta property="article:author" content="Fernando Escolar" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/24/azure-functions-net-5" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/10/efcore-vs-records" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/03/chorra-tip-1-wcd-command" />
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@fernandoescolar" />
		<meta name="twitter:creator" content="@fernandoescolar" />
		<meta name="twitter:title" content="Analizando la seguridad de una aplicación en .net
" />
		<meta name="twitter:description" content="Se han escrito muchas líneas acerca de la seguridad de las aplicaciones que realizamos en .Net. Se dice que son muy fáciles de hackear, que aun usando herram..." />
		<meta name="twitter:image" content="https://www.developerro.com/assets/apple-touch-icon-144-precomposed.png" />
		<meta name="twitter:url" content="https://www.developerro.com/2012/09/18/analizando-seguridad-aplicacion-net" />
		<meta name="description" content="Se han escrito muchas líneas acerca de la seguridad de las aplicaciones que realizamos en .Net. Se dice que son muy fáciles de hackear, que aun usando herram..." />
		<link rel="alternate" type="application/atom+xml" title="Developerro" href="/atom.xml" />
		<link rel="canonical" href="https://www.developerro.com/2012/09/18/analizando-seguridad-aplicacion-net" />
		<!-- Icons -->
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png" />
		<link rel="shortcut icon" href="/assets/favicon.ico" />
		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="Developerro" href="/atom.xml" />
		<!-- Styles -->
		<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" type="text/css" />
		<link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css" />
		<link rel="stylesheet" href="/assets/main.css" />
		<link rel="stylesheet" href="/assets/syntax.css" />
		<!-- Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163390000-1">
		</script>
		<script>
			
			    function activateGoogleAnalytics() {
			        window.dataLayer = window.dataLayer || [];
			        function gtag(){dataLayer.push(arguments);}
			        gtag('js', new Date());
			        gtag('config', 'UA-163390000-1');
			    }
			
		</script>
	</head>
	<body>
		<nav>
			<i id="hamburger">
			</i> <a href="/">
				<b>
					d</b>eveloperro
			</a>
			<ul>
				<li>
					<a href="/posts">blog
					</a>
				</li>
				<li>
					<a href="/about">
						acerca de
					</a>
				</li>
				<li>
					<a href="/archive">
						archivo
					</a>
				</li>
				<li>
					<a href="/projects">
						oss
					</a>
				</li>
				<li>
					<a href="/search">
						buscar
					</a>
				</li>
				<li>
					<a href="/videos">
						vídeos
					</a>
				</li>
			</ul>
		</nav>
		<header class="post">
			<h1>
				Analizando la seguridad de una aplicación en .net
			</h1><small>18 sep. 2012 · 7 min. de lectura
			</small>
		</header>
		<article class="post">
			<p>
				Se han escrito muchas líneas acerca de la seguridad de las aplicaciones que realizamos en .Net. Se dice que son muy fáciles de hackear, que aun usando herramientas de ofuscación, la seguridad de los empaquetados que se distribuyen es nula.
			</p>
			<!--break-->
			<p>
				Así pues, nos hemos propuesto buscar una aplicación comercial realizada con la Framework de .net de Microsoft y saltarnos su seguridad para poder disfrutar de todas las ventajas que tiene, pero sin pasar por caja.
			</p>
			<p>
				Para evitar problemas legales y que la aplicación se distribuya de forma ilegal, no vamos a publicar su nombre y el método empleado no será del todo completo. Pero si esperamos que el lector comprenda la dificultad y los pasos a dar para conseguir piratear una aplicación.
			</p>
			<p>
				Antes de empezar hemos tenido que instalar ciertas herramientas y aplicaciones:
			</p>
			<ul>
				<li>
					Red Gate Reflector
				</li>
				<li>
					Reflexil: AddIn para Reflector
				</li>
				<li>
					JetBrains dotPeek
				</li>
				<li>
					Visual Studio 2010
				</li>
				<li>
					Y cómo no, la aplicación que tenemos intención de hackear.
				</li>
			</ul>
			Lo primero que hemos hecho es observar la aplicación y encontrar un punto donde no nos deja acceder debido a que no tenemos la versión de pago. Esto ha ocurrido al intentar añadir una cuenta de usuario nueva al sistema. 
			<p>
				Hemos decidido abrir el ejecutable con la aplicación Reflector:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-01.png" alt="" width="472" height="454" /> 
			<p>
				Y nos hemos llevado una grata sorpresa al encontrar indicios del patrón Model-View-ViewModel. Una cosa que hemos aprendido en nuestros años de experiencia es que todo lo que se muestra en pantalla y utiliza este patrón, tiene que pasar por el ViewModel, con lo que no nos ha costado encontrar un lugar concreto donde la aplicación iba a comprobar que tenemos la versión de pago.
			</p>
			<p>
				A partir de este punto hemos decidido utilizar el dotPeek en lugar de Reflector, ya que trae una serie de herramientas de búsqueda y exploración que no trae (de serie) la anterior herramienta:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-02.png" alt="" width="647" height="604" /> 
			<p>
				Nos hemos situado en el lugar que sabíamos que la aplicación nos denegaba el acceso. Con la utilidad de buscar todos los usos de una variable, hemos realizado un escaneo, en busca del lugar donde se fija el valor de la variable que dice que no tenemos la versión de pago. Como resultado final hemos alcanzado una función llamada “CheckBoon” en una clase totalmente diferente a las que estábamos buscando en un principio.
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-03.png" alt="" width="750" /> 
			<p>
				Así que hemos vuelto a la herramienta de Reflector para sacarle partido al AddIn previamente instalado: Reflexil.
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-04.png" alt="" width="506" height="430" /> 
			<p>
				Al activarlo encontraremos una nueva ventana debajo del código descompilado con unos símbolos un tanto extraños en una lista. A estos comandos se les denomina IL o Intermediate Language, que es un lenguaje de programación de bajo nivel, en el que se convierten todas las aplicaciones de la plataforma .net, antes de convertirse en byte codes en forma de ensamblado.
			</p>
			<p>
				La virtud más importante de Reflexil es mostrar, editar y guardar cambios en este lenguaje, para un ensamblado ya compilado. Pero puede surgir el problema de que no todo el mundo conoce IL, y para solventarlo usaremos el Visual Studio.
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-05.png" alt="" width="750" /> 
			<p>
				La forma más simple de conseguir el código IL que necesitamos es escribir una simulación en un proyecto nuevo de Visual Studio para así poder encontrar el código IL con el tándem Reflector+Reflexil:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-06.png" alt="" width="397" height="448" /> 
			<p>
				Como resultado hemos simulado la función “CheckBoon” con un código semejante al que nos gustaría que tuviera.
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-07.png" alt="" width="750" /> 
			<p>
				Al coger esta nueva aplicación y abrirla con Reflector, encontraremos que Reflexil ya nos ha hecho el trabajo de convertir la función que deseamos a IL.
			</p>
			<p>
				A partir de aquí nuestro trabajo consistirá en borrar todas las instrucciones de la función original:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-08.png" alt="" width="611" height="558" /> 
			<p>
				Y añadir nuevas con la misma información (transformando nombres de propiedades y tipos de objeto) que podemos leer en nuestra simulación:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-09.png" alt="" width="552" height="186" /> 
			<p>
				Además, otra de las ventajas de Reflexil es que nos facilita la tarea con una pequeña herramienta para creación de instrucciones de IL, con un buscador de operadores incluido:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-10.png" alt="" width="486" height="651" /> 
			<p>
				Una vez tenemos todas las operaciones escritas, el código no cambiará pero el IL sí que estará como queríamos:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-11.png" alt="" width="605" height="428" /> 
			<p>
				Entonces solo nos quedarán dos acciones, la primera verificar los cambios que hemos realizado dirigiéndonos al panel de nuestra izquierda y en las opciones del ejecutable buscando Reflexil -> Verify:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-12.png" alt="" width="442" height="458" /> 
			<p>
				Si nos dice que todo está correcto:
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-13.png" alt="" width="240" height="155" /> 
			<p>
				En el mismo menú encontraremos la opción de guardar, momento en el que recomendamos no usar exactamente el mismo nombre que el ensamblado original por si acaso.
			</p><img style="display: block; margin-left: auto; margin-right: auto;" src="/assets/uploads/2012/10/net-hack-14.png" alt="" width="683" height="480" /> 
			<p>
				Y ejecutando nuestra versión “parcheada” en lugar de la original ya tendríamos las opciones de una versión de pago sin haber abonado el precio de la aplicación.
			</p>
			<p>
				Ahora que cada uno saque sus propias conclusiones. Personalmente considero que un desarrollador al que realmente le importe la seguridad, se puede encontrar desolado tras leer este artículo, ya que Microsoft continúa con una asignatura pendiente en el tema de la seguridad de los ensamblado de la plataforma .Net.
			</p>
		</article>
		<section id="share">
			<a href="https://twitter.com/intent/tweet?text=Analizando la seguridad de una aplicación en .net
&url=https://www.developerro.com/2012/09/18/analizando-seguridad-aplicacion-net" rel="nofollow" target="_blank" title="Share on Twitter">
				<i class="fab fa-twitter">
				</i>
			</a> <a href="https://facebook.com/sharer.php?u=https://www.developerro.com/2012/09/18/analizando-seguridad-aplicacion-net" rel="nofollow" target="_blank" title="Share on Facebook">
				<i class="fab fa-facebook"></i>
			</a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.developerro.com/2012/09/18/analizando-seguridad-aplicacion-net" rel="nofollow" target="_blank" title="Share on Linkedlin">
				<i class="fab fa-linkedin"></i>
			</a> <a href="http://www.reddit.com/submit?url=https://www.developerro.com/2012/09/18/analizando-seguridad-aplicacion-net" rel="nofollow" target="_blank" title="Share on Reddit">
				<i class="fab fa-reddit"></i>
			</a> <a href="https://www.buymeacoffee.com/fernandoescolar" rel="nofollow" target="_blank" title="Buy me a beer">
				<i class="fa fa-beer"></i> buy me a beer
			</a>
		</section>
		<section id="related">
			<h2>
				Relacionado (o no)
			</h2>
			<ul>
				<li>
					<a href="/2021/03/24/azure-functions-net-5">
						Azure Functions con .NET 5
					</a> <small>24 mar. 2021
					</small>
				</li>
				<li>
					<a href="/2021/03/10/efcore-vs-records">
						EF Core vs. Records
					</a> <small>10 mar. 2021
					</small>
				</li>
				<li>
					<a href="/2021/03/03/chorra-tip-1-wcd-command">
						ChorraTip: rutas windows en git bash
					</a> <small>03 mar. 2021
					</small>
				</li>
				<li>
					<a href="/video/2021/02/27/raiders-od-the-lost-leak">
						Raiders of the lost leak
					</a> <small>27 feb. 2021
					</small>
				</li>
				<li>
					<a href="/video/2020/12/09/net-5-just-talking">
						.Net 5 Just Talking
					</a> <small>09 dic. 2020
					</small>
				</li>
			</ul>
		</section>
		<footer>
			<ul>
				<li>
					<a href="mailto:fer.escolar@gmail.com" target="_blank">
						<i class="far fa-envelope">
						</i>
					</a>
				</li>
				<li>
					<a href="https://twitter.com/fernandoescolar" target="_blank">
						<i class="fab fa-twitter">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.linkedin.com/in/fernandoescolar" target="_blank">
						<i class="fab fa-linkedin">
						</i>
					</a>
				</li>
				<li>
					<a href="https://github.com/fernandoescolar" target="_blank">
						<i class="fab fa-github">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.buymeacoffee.com/fernandoescolar" target="_blank">
						<i class="fa fa-beer">
						</i>
					</a>
				</li>
			</ul><a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">
				<img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
			</a>
		</footer>
		<dialog id="cookie-notice">
			Nos gustaría usar cookies de terceros para hacer este sitio mejor. <a id="cookie-notice-accept">vale
			</a>
		</dialog>
		<script src="/assets/scripts.js">
		</script>
	</body>
</html>