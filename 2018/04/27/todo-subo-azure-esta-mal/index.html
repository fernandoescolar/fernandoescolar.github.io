<!DOCTYPE html>
<html lang="es-es">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<title>
			Por qu√© todo lo que subo a azure est√° mal ¬∑ developerro
		</title>
		<!-- Social Metas -->
		<meta name="description" content="Hoy he venido contaros mis experiencias ayudando a diferentes empresas en la subida de sus aplicaciones a azure, y concretamente a azure PaaS. As&#237; que en rea..." />
		<meta property="og:title" content="Por qu√© todo lo que subo a azure est√° mal" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://www.developerro.com/2018/04/27/todo-subo-azure-esta-mal" />
		<meta property="og:image" content="https://www.developerro.com/assets/apple-touch-icon-144-precomposed.png" />
		<meta property="og:description" content="Hoy he venido contaros mis experiencias ayudando a diferentes empresas en la subida de sus aplicaciones a azure, y concretamente a azure PaaS. As√≠ que en rea..." />
		<meta property="og:site_name" content="developerro" />
		<meta property="og:locale" content="es_es" />
		<meta property="article:modified_time" content="2017-04-27 09:06:12Z" />
		<meta property="article:published_time" content="2017-04-27 09:06:12Z" />
		<meta property="article:author" content="Fernando Escolar" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/24/azure-functions-net-5" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/10/efcore-vs-records" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/03/chorra-tip-1-wcd-command" />
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@fernandoescolar" />
		<meta name="twitter:creator" content="@fernandoescolar" />
		<meta name="twitter:title" content="Por qu√© todo lo que subo a azure est√° mal" />
		<meta name="twitter:description" content="Hoy he venido contaros mis experiencias ayudando a diferentes empresas en la subida de sus aplicaciones a azure, y concretamente a azure PaaS. As√≠ que en rea..." />
		<meta name="twitter:image" content="https://www.developerro.com/assets/apple-touch-icon-144-precomposed.png" />
		<meta name="twitter:url" content="https://www.developerro.com/2018/04/27/todo-subo-azure-esta-mal" />
		<meta name="description" content="Hoy he venido contaros mis experiencias ayudando a diferentes empresas en la subida de sus aplicaciones a azure, y concretamente a azure PaaS. As√≠ que en rea..." />
		<link rel="alternate" type="application/atom+xml" title="Developerro" href="/atom.xml" />
		<link rel="canonical" href="https://www.developerro.com/2018/04/27/todo-subo-azure-esta-mal" />
		<!-- Icons -->
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png" />
		<link rel="shortcut icon" href="/assets/favicon.ico" />
		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="Developerro" href="/atom.xml" />
		<!-- Styles -->
		<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" type="text/css" />
		<link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css" />
		<link rel="stylesheet" href="/assets/main.css" />
		<link rel="stylesheet" href="/assets/syntax.css" />
		<!-- Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163390000-1">
		</script>
		<script>
			
			    function activateGoogleAnalytics() {
			        window.dataLayer = window.dataLayer || [];
			        function gtag(){dataLayer.push(arguments);}
			        gtag('js', new Date());
			        gtag('config', 'UA-163390000-1');
			    }
			
		</script>
	</head>
	<body>
		<nav>
			<i id="hamburger">
			</i> <a href="/">
				<b>
					d</b>eveloperro
			</a>
			<ul>
				<li>
					<a href="/posts">blog
					</a>
				</li>
				<li>
					<a href="/about">
						acerca de
					</a>
				</li>
				<li>
					<a href="/archive">
						archivo
					</a>
				</li>
				<li>
					<a href="/projects">
						oss
					</a>
				</li>
				<li>
					<a href="/search">
						buscar
					</a>
				</li>
				<li>
					<a href="/videos">
						v√≠deos
					</a>
				</li>
			</ul>
		</nav>
		<header class="post">
			<h1>
				Por qu√© todo lo que subo a azure est√° mal
			</h1><small>27 abr. 2017 ¬∑ 22 min. de lectura
			</small>
		</header>
		<article class="post">
			<p>
				Hoy he venido contaros mis experiencias ayudando a diferentes empresas en la subida de sus aplicaciones a azure, y concretamente a azure PaaS. As√≠ que en realidad no son mis experiencias, son las de esas empresas. Y si soy totalmente sincero, no son sus experiencias, en realidad de lo que os voy a hablar es de sus quejas.
				<!--break-->
			</p>
			<div style="background-color: #f4c24b; font-size: 12px; font-style: italic; padding: 5px;">
				Este documento corresponde con el gui√≥n realizado para dar la charla de "Por qu√© todo lo que subo a azure est√° mal" para la Global Azure Bootcamp de 2018. Si lo prefieres, puedes ver el v√≠deo de la charla en <a href="https://www.youtube.com/watch?v=cMwHQlmGnr0" alt="Canal de YouTube de GAB 2018">este enlace
				</a>.
			</div>
			<h2 id="un-poco-de-historia">
				Un poco de historia
			</h2>
			<p>
				Dejad que os cuente una peque√±a historia:
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide03.png" alt="una peque√±a historia" />
			</p>
			<p>
				Todo empez√≥ en 1981, cuando nac√≠. Aqu√≠ en Madrid. Desde entonces he estado muy cerca de los ordenadores. La d√©cada de los 90 mi padre me estuvo ense√±ando C++. Ah√≠ estaba yo con Visual Studio y las Microsoft Foundation Classes. Sin entender muy bien exactamente por qu√© se dibujaba un bot√≥n en la pantalla.
			</p>
			<p>
				El caso es que aunque mi vida es muy divertida, en realidad lo que hoy nos interesa es la experiencia que puedo aportar en azure. Esto empez√≥ en 2010, cuando a√∫n lo llam√°bamos Windows Azure. El portal de gesti√≥n estaba hecho en una tecnolog√≠a llamada a "petarlo" en programaci√≥n web como es... era Silverlight. Ah√≠ conocimos los storages y cloud services. Nos peleamos con el auto escalado usando Wasabi y en relidad todo era mucho m√°s dif√≠cil que ahora.
			</p>
			<p>
				Por ah√≠ por el 2015 Microsoft nos propuso a Tokiota colaborar con ellos en unas jornadas que serv√≠an para ayudar a otras empresas a subir a sus aplicaciones a azure. Y ah√≠ es cuando realmente empezamos a pelearnos y a aprender con retos de todo tipo, que hoy veremos.
			</p>
			<h2 id="el-camino-a-la-nube">
				El camino a la nube
			</h2>
			<p>
				Supongo que todos los aqu√≠ presentes habr√°n hecho alguno de los tutoriales de la extensa y a la vez excelsa documentaci√≥n que Microsoft tiene a nuestra disposici√≥n en internet. Todo funciona genial. Creo que la primera vez que escuche eso de "azure nos obliga a programar bien" fue a Gisela Torres. En una charla no muy diferente de esta. Y es verdad. Esto est√° genial. Pero no cuando ya tienes una aplicaci√≥n desarrollada que no ha sido pensada para ser subida a la nube, la cosa cambia.
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide04.png" alt="el camino a la nube" />
			</p>
			<p>
				As√≠ que decidimos hacer un "ABC". Una especie de metodolog√≠a, gu√≠a o industrializaci√≥n de las migraciones que est√°bamos realizando. Y lo llamamos "el camino a la nube". Lo simplificamos de tal manera que lo resumimos en 4 sencillos pasos.
			</p>
			<p>
				B√°sicamente se trataba de conseguir que las aplicaciones de estas empresas fueran escalables horizontalmente. As√≠ que nos fijamos solo en los recursos:
			</p>
			<ul>
				<li>
					<p>
						Los archivos que se generan o que se suben a esta aplicaci√≥n ya no pueden estar en el propio "file system" del servidor que la contiene. Al poder tener muchas instancias hay que almacenarlos en una unidad compartida. Por ejemplo, un blob storage.
					</p>
				</li>
				<li>
					<p>
						Las variables de sesi√≥n. S√≠ ya s√© que aqu√≠ todos programamos servicios stateless. Pero esto no ha sido as√≠ siempre. A lo que iba: Las variables de sesi√≥n deber√≠an estar en un almac√©n compartido y que sea r√°pido. Como por ejemplo un redis cache.
					</p>
				</li>
				<li>
					<p>
						Y esto nos lleva al uso de una cach√©. Si nuestra aplicaci√≥n, con el fin de tener los datos de una forma m√°s din√°mica, usa una memoria cach√©, esta tiene que ser provista por un servicio externo y compartido. Como por ejemplo el ya mencionado azure redis cache.
					</p>
				</li>
				<li>
					<p>
						Para terminar, nos ten√≠amos que fijar en la base de datos. Hay ciertas incompatibilidades con respecto un sql server completo a uno en la nube. Y afortunadamente disponemos de varias herramientas que nos pueden ayudar con esta tares.
					</p>
				</li>
			</ul>
			<p>
				Si ten√≠amos resueltos estos casos ya est√°bamos listos para poder subir a la nube... ¬øo no?
			</p>
			<h2 id="empiezan-los-problemas">
				Empiezan los problemas
			</h2>
			<p>
				Nuestro camino a la nube se hab√≠a visto muy eficaz en la migraci√≥n de muchas clases de WebApps, pero fue justo entonces cuando comenzaron los problemas. Las compa√±√≠as a las que ayud√°bamos estaban poniendo sus aplicaciones en producci√≥n en la nube, estaban empezando a investigar por su cuenta y a tomarse licencias fuera de lo que nosotros consider√°bamos como una mera prueba de concepto. Un peque√±o empuj√≥n que les ayudar√≠a a usar los servicios PaaS de azure.
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide05.png" alt="empieza los problemas" />
			</p>
			<p>
				Nuestros desarrollos internos funcionaban genial. Es m√°s, en Tokiota no tenemos servidores, usamos azure. Y est√°bamos muy contentos con la calidad del servicio.
			</p>
			<p>
				Pero para las empresas que ayud√°bamos, la cosa no estaba yendo bien. ¬øQuiz√° nos hab√≠amos confundido? ¬øquiz√° azure no era tan bueno? ¬øes posible que tuvi√©ramos que revisar todo nuestro proceso y prestar m√°s atenci√≥n a los detalles?
			</p>
			<p>
				Posiblemente s√≠. Y es aqu√≠ donde surge el enfado. El enfado lleva al odio. Y al final desemboca en una fase de apat√≠a. (no en el lado oscuro ;P)
			</p>
			<p>
				Para evitar este devenir de los sentimientos ten√≠amos un plan. Apuntamos lo que nos dec√≠an esas empresas y debajo a√±ad√≠amos nuestras notas sobre la soluci√≥n. Al documento resultando lo llamamos "Mis Notas". As√≠ todos los consultores lo considerar√≠an suyo. Podr√≠an modificarlo. A√±adir o borrar nueva informaci√≥n.
			</p>
			<p>
				Y lo que hoy os traigo son lagunas de las notas m√°s destacadas de "Mis Notas":
			</p>
			<h3 id="en-mi-maquina-va-genial-pero-cuando-subo-lo-mismo-a-azure-va-super-lento">
				EN MI M√ÅQUINA VA GENIAL, PERO CUANDO SUBO LO MISMO A AZURE VA SUPER LENTO
			</h3>
			<p>
				Esta frase es la sustituci√≥n del m√≠tico "Works in my machine" o "En mi m√°quina funciona". Y jam√°s he puesto en duda semejante afirmaci√≥n. Pero claro, si mi port√°til es un i7 con 16 Gb de RAM y 512 Gb de SSD y en azure me decanto por una m√°quina con 1 core y 1,75Gb de RAM y HDD virtual... Y eso sin contar con el tema de que en mi m√°quina estoy lanzando un servidor de desarrollo al que solo accedo yo (como podr√≠a ser IIS Express), mientras que en azure est√°n entrando tropecientos usuarios a la vez.
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide07.png" alt="recomendaciones generales" />
			</p>
			<p>
				Aunque en realidad nosotros en nuestras aplicaciones con 100 usuario concurrentes y una instancia de las m√°s peque√±as no hemos encontrado problemas...
			</p>
			<p>
				De cualquier forma, uno de los puntos que siempre hay que revisar en azure es que todos los servicios de usemos en una aplicaci√≥n est√©n hospedados en la misma regi√≥n. En el mismo data center. Primero por los temas de performance, pero segundo porque adem√°s el tr√°fico de azure a azure en el mismo datacenter no nos lo cobran.
			</p>
			<p>
				Otro detalle que es importante es usar al menos instancias est√°ndar o "S" en nuestros servicios de producci√≥n. Y a partir de estos tama√±os buscar el m√°s adecuado para hospedar nuestro servicio. A parte de los t√≠picos valores de CPU, RAM y disco, tambi√©n vienen asociadas con el tama√±o de una instancia otros factores como el n√∫mero de conexiones, las I/Os... que son muy importantes tambi√©n.
			</p>
			<p>
				Y el √∫ltimo consejo en general para usar cualquier servicio de azure es realizar siempre procesos cortos. Si por A o por B tenemos un proceso que nos va a llevar mucho tiempo (y cuando digo mucho es m√°s de 1 segundo) lo mejor que podemos hacer es distribuirlo y ejecutarlo en los servicios adecuados para estas tareas como por ejemplo WebJobs, Azure Functions o si tenemos algo grande de verdad un azure batch.
			</p>
			<h3 id="si-aad-ya-tiene-gestor-de-usuarios-para-que-hacer-el-mio-dentro-de-mi-aplicacion">
				Si AAD ya tiene gestor de usuarios, ¬øpara qu√© hacer el m√≠o dentro de mi aplicaci√≥n?
			</h3>
			<p>
				No comet√°is este grabe error. Os perseguir√° el resto de vuestra vida laboral.
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide09.png" alt="Recomendaciones para Azure Active Directory" />
			</p>
			<p>
				Lo primero que tenemos que hacer es conocer que es lo que hace AAD cuando delegamos la autenticaci√≥n y autorizaci√≥n de usuarios. Autenticaci√≥n es ese proceso en el que validamos que un usuario es en realidad quien dice ser. Autorizaci√≥n es cuando decidimos si un usuario tiene permisos para ver un recurso en concreto (nuestra webapp).
			</p>
			<p>
				Si dejamos que nuestro gestor de usuarios sea el AAD: qu√© pasa si borramos un usuario? Perder√≠amos todos sus datos? como no podemos hacer login con ese usuario queda en un estado de limbo dentro de nuestra aplicaci√≥n o como va eso?
			</p>
			<p>
				Siempre recomendar√© que la autenticaci√≥n la realice AAD por nosotros. E incluso el tema de autorizaci√≥n para entrar en nuestra p√°gina web. Pero el tema de la autorizaci√≥n sobre datos concretos de nuestra aplicaci√≥n tenemos que gestionarla nosotros.
			</p>
			<p>
				As√≠ que os recomiendo:
			</p>
			<ul>
				<li>
					<p>
						Almacenar los usuarios de AAD en nuestra aplicaci√≥n. Incluso podr√≠amos decidir crear un usuario si no existe en el login.
					</p>
				</li>
				<li>
					<p>
						Este usuario relacionarlo con el usuario del AAD v√≠a el UPN. Pero que tenga su propio ID.
					</p>
				</li>
				<li>
					<p>
						Almacenar los permisos dentro de la aplicaci√≥n (si es que son necesarios) en nuestra aplicaci√≥n y relacionados con el usuario de nuestra aplicaci√≥n.
					</p>
				</li>
				<li>
					<p>
						Si necesitamos relacionar alg√∫n dato con un usuario no usar el UPN m√°s que para el propio usuario. En el resto de datos relacionarlo con los usuarios internos de la aplicaci√≥n.
					</p>
				</li>
			</ul>
			<h3 id="el-servicio-de-azure-redis-cache-es-muy-lento">
				EL SERVICIO DE AZURE REDIS CACHE ES MUY LENTO...
			</h3>
			<p>
				Redis es de las bases de datos relacionales m√°s r√°pidas que existen. Trabaja en memoria lo que la hace ideal para comportarse como un servicio de cach√©. As√≠ que, si redis funciona lento, lo m√°s razonable es que el problema no sea de redis.
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide11.png" alt="Recomendaciones para redis" />
			</p>
			<ul>
				<li>
					<p>
						Lo primero que debes hacer es activar desde el portal el "Redis cache advisor", un asistente/herramienta que detectar√° y avisar√° sobre los defectos t√≠picos que podamos tener a la hora de gestionar redis.
					</p>
				</li>
				<li>
					<p>
						Por mi experiencia los problemas suelen estar en almacenar valores muy grandes dentro de una sola key. Algo muy com√∫n cuando heredamos una aplicaci√≥n que se program√≥ usando variables de sesi√≥n en memoria local. Aunque redis soporta sin problemas valores bastante grandes, si queremos sacarle partido a sus caracter√≠sticas lo mejor es almacenar muchas keys con valores m√°s peque√±os. Si necesitamos recoger y pre filtrar varias de esas opciones en una sola consulta; redis nos puede ayudar d√°ndonos muestras de lo realmente r√°pido que es.
					</p>
				</li>
				<li>
					<p>
						Igual que nos sucede con los dem√°s servicios de azure, pero en redis lo miramos menos porque es un poco m√°s caro: hay que conocer los detalles de l√≠mites de conexiones concurrentes en cada tama√±o de instancia de redis. Puede ser que los problemas que experimentamos de rendimiento se deban a que tenemos muchas m√°s conexiones de las que somos capaces de gestionar y esto hace que se vayan creando nuevas conexiones cada poco. Lo cual enlentece mucho la experiencia.
					</p>
				</li>
				<li>
					<p>
						Como nota, aunque nada recomendable, os puedo decir que el cifrado SSL le sienta especialmente mal al protocolo que usa redis para comunicarse. As√≠ que, si ten√©is redis en dentro de una vnet y sin acceso desde otro lugar que no sea esa vnet, pod√©is desactivar el SSL y ver c√≥mo se incrementa la velocidad.
					</p>
				</li>
				<li>
					<p>
						Y por √∫ltimo, sobre todo para aquellos que trabaj√°is con lenguajes como PHP o nodejs, existe un gateway simulado dentro de los appservices para poder usar redis usando el protocolo de memcached. Y es realmente eficiente si solo queremos usarlo como cach√©. Aunque as√≠ nos perder√≠amos las otras grandes ventajas que tiene redis...
					</p>
				</li>
			</ul>
			<h3 id="estoy-muy-contento-con-el-servicio-de-cosmos-db-pero-es-carisimo">
				ESTOY MUY CONTENTO CON EL SERVICIO DE COSMOS DB PERO ES CAR√çSIMO
			</h3>
			<p>
				¬øQu√© entendemos como caro?
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide13.png" alt="Recomendaciones Azure Cosmos Db" />
			</p>
			<p>
				Esta frase es muy frecuente y es porque dentro de Cosmos DB, una colecci√≥n es tratada, por as√≠ decirlo, como una base de datos. Las colecciones se facturan por separado y la colecci√≥n m√≠nima que podemos contratar es de 400 RU. Teniendo en cuenta que el precio por RU es m√°s o menos 5 ‚Ç¨ por cada 100, el precio m√≠nimo de una colecci√≥n es de unos 20 ‚Ç¨.
			</p>
			<p>
				Si a esto le sumamos que cada "entidad" (como si fueran tablas de entity framework) la guardamos en una colecci√≥n diferente y tenemos, por decir algo, 18 entidades: ser√≠an unos 300 ‚Ç¨ al mes con el a√±adido de que estamos (infra) usando 7200 RUs.
			</p>
			<p>
				Si lo vemos as√≠ no es tan caro. As√≠ que os proponemos 3 ideas:
			</p>
			<ul>
				<li>
					<p>
						La primera es que una colecci√≥n de cosmos DB almacena documentos sin esquema. Eso se traduce en que podemos tener documentos con diferentes propiedades (y por tanto diferentes tipos de documento) en una sola colecci√≥n.
					</p>
				</li>
				<li>
					<p>
						La segunda es que las colecciones se pueden particionar por alg√∫n valor de alguna propiedad. Si por ejemplo creamos en todas nuestras entidades una propiedad que sea el tipo de entidad como un string podr√≠amos particionar f√≠sicamente los datos para que fuera m√°s eficiente acceder a ellos.
					</p>
				</li>
				<li>
					<p>
						Y la tercera es que no pens√©is en tablas cuando us√©is cosmos DB, pensad en documentos. Y si no usad mejor sql database.
					</p>
				</li>
			</ul>
			<p>
				Como bola extra os comentar√© que cuando usamos el cliente de .net lo mejor es usar las llamadas as√≠ncronas y la conexi√≥n hacerla por TCP y activando el "direct mode".
			</p>
			<h3 id="se-me-bloquea-la-base-de-datos-en-los-momentos-de-mayor-uso-y-ya-no-puedo-escalar-mas">
				SE ME BLOQUEA LA BASE DE DATOS EN LOS MOMENTOS DE MAYOR USO Y YA NO PUEDO ESCALAR M√ÅS
			</h3>
			<p>
				Con el servicio de SQL database nos hemos encontrado un festival de problemas de "performance". Aunque generalmente se debe a que la gente est√° acostumbrada al cluster de su empresa de SQL Server que tiene 3 servidores con 64Gb de RAM, las cabinas de la leche que se conectan con fibra y bueno, la factura que da miedo.
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide15.png" alt="Recomendaciones Azure Sql Database" />
			</p>
			<p>
				Estos servidores suelen ocultar las operaciones que tienen una performance fatal. As√≠ que cuando vamos al servicio PaaS de azure de base de datos, como usamos instancias peque√±as, se hacen evidentes. Pero no os estoy diciendo que us√©is tama√±os m√°s grandes de SQL Database. Creo que sale m√°s rentable invertir en mejorar nuestra queries.
			</p>
			<ul>
				<li>
					<p>
						La primera recomendaci√≥n cuando usamos SQL Database es que migremos usando los asistentes de SSMS.
					</p>
				</li>
				<li>
					<p>
						Lo segundo que debemos hacer es activar el SQL Database Advisor, que al igual que el de redis, nos va a avisar de aquellos defectos t√≠picos que encuentre. E incluso nos propondr√° realizar modificaciones en el esquema de la base de datos. Como por ejemplo, proponi√©ndonos √≠ndices nuevos.
					</p>
				</li>
				<li>
					<p>
						Supongo que no soy el primero en decirlo, pero no almacen√©is la l√≥gica de negocio embebida en la base de datos en forma de stored procedures con transacciones. Si estos procesos son muy largos, al final lo que vais a conseguir es bloquear muchas tablas y como consecuencia a todos los dem√°s usuarios que acceden a la web.
					</p>
				</li>
				<li>
					<p>
						Usad la herramienta que nos proporciona el portal de azure "query performance insight" para poder medir la eficiencia de vuestras queries.
					</p>
				</li>
				<li>
					<p>
						Para saber el tama√±o de instancia que necesitamos en azure, como se usa el t√©rmino DTU para ello, tenemos un DTU calculator online que nos puede ayudar.
					</p>
				</li>
			</ul>
			<h3 id="claro-como-azure-es-de-microsoft-las-aplicaciones-desarrolladas-en-node-van-fatal">
				¬°CLARO! COMO AZURE ES DE MICROSOFT LAS APLICACIONES DESARROLLADAS EN NODE VAN FATAL
			</h3>
			<p>
				Ahora empezamos con la ronda de mentiras. Nodejs funciona en los application services genial. Pero si que es verdad que tenemos que tener en cuenta que si usamos instancias con windows, nodejs se usa mediante el m√≥dulo de IIS llamado IISNODE. Y este m√≥dulo tiene ciertas peculiaridades:
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide17.png" alt="Recomendaciones App Services con nodejs" />
			</p>
			<ul>
				<li>
					<p>
						Los node cluster (haciendo master y slave) no funcionan a trav√©s del IISNODE. A cambio hay unos par√°metros de configuraci√≥n que se le pueden pasar en el web.config o en un fichero a parte llamado "iisnode.yml" donde adem√°s de muchas otras cosas podremos configurar cuantas instancias de node queremos que lance el IISNODE.
					</p>
				</li>
				<li>
					<p>
						Si vamos a usar sockets tenemos que activarlo en la configuraci√≥n del portal. Si no simplemente se bloquean.
					</p>
				</li>
				<li>
					<p>
						Si no tenemos buena performance, podemos probar a usar el paquete de npm llamado v8-profiler, que se integra con chrome y bueno, nos puede resolver muchas dudas sobre donde estamos teniendo problemas.
					</p>
				</li>
			</ul>
			<h3 id="microsoft-hace-que-las-aplicaciones-de-php-se-arrastren-para-que-programes-en.net">
				MICROSOFT HACE QUE LAS APLICACIONES DE PHP SE ARRASTREN PARA QUE PROGRAMES EN .NET
			</h3>
			<p>
				Si me conoc√©is sabr√©is que soy programador fundamentalmente de .net, no de PHP ni Java. As√≠ que en estos puntos no os podr√© dar tantos consejos. Pero si que tengo algunos sobre las aplicaciones en PHP como por ejemplo wordpress:
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide19.png" alt="Recomendaciones para App Services con PHP" />
			</p>
			<ul>
				<li>
					<p>
						El app services (windows) el archivo "php.ini" se sustituye por el ".user.ini". Jugad ah√≠ con las diferentes configuraciones generales de PHP.
					</p>
				</li>
				<li>
					<p>
						Podemos a√±adir extensiones a PHP en forma de binarios subi√©ndolos a una carpeta junto con nuestra aplicaci√≥n e indicando que las cargue bien por un par√°metro de configuraci√≥n del servicio o bien en el archivo .ini. As√≠ que ya no hay escusas para no usar memcached üòâ.
					</p>
				</li>
				<li>
					<p>
						Usad siempre la versi√≥n m√°s alta de PHP. Sobre todo a partir de la 7, donde mejora much√≠simo la performace en comparaci√≥n con por ejemplo la 4.X.
					</p>
				</li>
				<li>
					<p>
						Y por √∫ltimo, hay peque√±os trucos mezclando memcached, con IIS y con las cach√©s, que mediante configuraciones que podr√©is encontrar en internet nos ayudar√°n a que haya p√°ginas de php que sean guardadas en la cach√© y que la velocidad de nuestra aplicaci√≥n se incremente much√≠simo.
					</p>
				</li>
			</ul>
			<h3 id="funciona-tomcat-en-azure-bueno-yo-tengo-mi-propio-tomcat-customizado">
				¬øFUNCIONA TOMCAT EN AZURE? BUENO, YO TENGO MI PROPIO TOMCAT CUSTOMIZADO...
			</h3>
			<p>
				Aun recuerdo la primera vez que una empresa vino con su Tomcat customizado. Y las que les han seguido!. Tomcat funciona en App Services. Y puedes subir el tuyo customizado. Lo m√°s recomendable es buscar en la galer√≠a una Web App con la √∫ltima versi√≥n de Tomcat. Este template se descarga el tomcat desde los servidores oficiales a la WebApp. Una vez ah√≠, solo tienes que sustituirlo por el tuyo. Aunque es muy posible que le tengas que hacer retoques. No es lo mismo un tomcat en tu datacenter que en azure...
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide21.png" alt="Recomendaciones para App Services con Java" />
			</p>
			<p>
				A parte de las t√≠picas recomendaciones de cuidado con el tama√±o de la instancia y el usa cach√©s all√≠ donde puedas, nos encontramos tambi√©n una peque√±a curiosidad:
			</p>
			<ul>
				<li>
					Usando Hibernate, el conocido ORM de java, tienes que garantizar que todas las cadenas de tu base de datos sean "nvarchar" y no "varchar" a secas. Resulta que Hibernate trabaja con caracteres unicode s√≠ o s√≠, as√≠ que si no usas nvarchar los convierte. Esto hace que la performance caiga en picado.
				</li>
			</ul>
			<h3 id="es-que-azure-es-muy-caro">
				ES QUE AZURE ES MUY CARO
			</h3>
			<p>
				Y hemos llegado a la pen√∫ltima frase que m√°s hemos o√≠do migrando aplicaciones a azure: es muy caro.
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide23.png" alt="Sobre el precio de Azure" />
			</p>
			<ul>
				<li>
					<p>
						Azure no es v√°lido para todo el mundo. Si una empresa tiene un peque√±o aplicativo en un hosting de 100‚Ç¨ al a√±o que es muy lento y no tiene SLAs, azure le va a resultar muy caro. Posiblemente la plataforma no sea para ellos.
					</p>
				</li>
				<li>
					<p>
						Pero si tenemos en cuenta que 24x7, los SLAs de 99,9[5|9] de disponibilidad, que por ejemplo 1Tb con sus 3 replicas solo cuestan 16 ‚Ç¨ al mes... Creo que ya lo hemos dicho todo...
					</p>
				</li>
			</ul>
			<h3 id="si-no-me-lo-arregla-microsoft-me-voy-a-ir-a-amazon">
				SI no me lo arregla Microsoft, ME VOY A IR A AMAZON
			</h3>
			<p>
				Y por √∫ltimo el ganador. La persona que como no est√° contenta con su aplicaci√≥n te suelta una amenaza. A mi ni me va ni me viene. Yo no trabajo en Microsoft. Pero la gente te lo dice igualmente.
			</p>
			<p>
				<img src="/assets/uploads/2018/04/Slide25.png" alt="Me voy a amazon" />
			</p>
			<p>
				Mi respuesta se divide en dos puntos:
			</p>
			<ul>
				<li>
					<p>
						AWS es una gran plataforma cloud. En algunos aspectos es muy posible que sea superior a Azure. Y en otros ser√° Azure quien es superior. En el tema de PaaS a mi personalmente me gusta mucho azure y la forma de exponer sus precios. Pero es v√°lido tener AWS e incluso m√°s de un proveedor de cloud. La diversificaci√≥n es buena para una empresa. No atarse...
					</p>
				</li>
				<li>
					<p>
						Y por √∫ltimo: si en Azure te funciona mal... en amazon por el mismo precio, no lo va a hacer mejor.
					</p>
				</li>
			</ul>
			<h2 id="en-resumen">
				En resumen
			</h2>
			<p>
				As√≠ que intentando responder a la pregunta ret√≥rica que formul√°bamos al inicio de la sesi√≥n: ¬øPor qu√© todo lo que subo a azure est√° mal?
			</p>
			<p>
				Pues posiblemente porque est√° mal. Y encima la culpa es m√≠a.
			</p>
		</article>
		<section id="share">
			<a href="https://twitter.com/intent/tweet?text=Por qu√© todo lo que subo a azure est√° mal&url=https://www.developerro.com/2018/04/27/todo-subo-azure-esta-mal" rel="nofollow" target="_blank" title="Share on Twitter">
				<i class="fab fa-twitter">
				</i>
			</a> <a href="https://facebook.com/sharer.php?u=https://www.developerro.com/2018/04/27/todo-subo-azure-esta-mal" rel="nofollow" target="_blank" title="Share on Facebook">
				<i class="fab fa-facebook"></i>
			</a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.developerro.com/2018/04/27/todo-subo-azure-esta-mal" rel="nofollow" target="_blank" title="Share on Linkedlin">
				<i class="fab fa-linkedin"></i>
			</a> <a href="http://www.reddit.com/submit?url=https://www.developerro.com/2018/04/27/todo-subo-azure-esta-mal" rel="nofollow" target="_blank" title="Share on Reddit">
				<i class="fab fa-reddit"></i>
			</a> <a href="https://www.buymeacoffee.com/fernandoescolar" rel="nofollow" target="_blank" title="Buy me a beer">
				<i class="fa fa-beer"></i> buy me a beer
			</a>
		</section>
		<section id="related">
			<h2>
				Relacionado (o no)
			</h2>
			<ul>
				<li>
					<a href="/video/2020/07/31/azure-summer-talks">
						Azure Summer Talks Community
					</a> <small>31 jul. 2020
					</small>
				</li>
				<li>
					<a href="/video/2018/04/26/gab18-todo-subo-azure-esta-mal">
						GAB18 - Por qu√© todo lo que subo a azure est√° mal
					</a> <small>26 abr. 2018
					</small>
				</li>
				<li>
					<a href="/video/2020/10/19/workshop-azure">
						Workshop Azure 100M
					</a> <small>19 oct. 2020
					</small>
				</li>
				<li>
					<a href="/video/2020/09/10/advanced-azure-webapps">
						The Hitchhiker's Guide to Azure WebApps
					</a> <small>10 sep. 2020
					</small>
				</li>
				<li>
					<a href="/2020/08/26/azure-webapps-tips-n-tricks">
						Azure WebApps Tips & Tricks
					</a> <small>26 ago. 2020
					</small>
				</li>
			</ul>
		</section>
		<footer>
			<ul>
				<li>
					<a href="mailto:fer.escolar@gmail.com" target="_blank">
						<i class="far fa-envelope">
						</i>
					</a>
				</li>
				<li>
					<a href="https://twitter.com/fernandoescolar" target="_blank">
						<i class="fab fa-twitter">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.linkedin.com/in/fernandoescolar" target="_blank">
						<i class="fab fa-linkedin">
						</i>
					</a>
				</li>
				<li>
					<a href="https://github.com/fernandoescolar" target="_blank">
						<i class="fab fa-github">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.buymeacoffee.com/fernandoescolar" target="_blank">
						<i class="fa fa-beer">
						</i>
					</a>
				</li>
			</ul><a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">
				<img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
			</a>
		</footer>
		<dialog id="cookie-notice">
			Nos gustar√≠a usar cookies de terceros para hacer este sitio mejor. <a id="cookie-notice-accept">vale
			</a>
		</dialog>
		<script src="/assets/scripts.js">
		</script>
	</body>
</html>