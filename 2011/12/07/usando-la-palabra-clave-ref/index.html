<!DOCTYPE html>
<html lang="es-es">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<title>
			Usando la palabra clave “ref” · developerro
		</title>
		<!-- Social Metas -->
		<meta name="description" content="No hace mucho, estabamos tomando unas cervezas algunos desarrolladores de .net de Barcelona. Entonces sali&amp;oacute; el tema de los talibanes del c&amp;oacute;digo..." />
		<meta property="og:title" content="Usando la palabra clave &#8220;ref&#8221;" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://www.developerro.com/2011/12/07/usando-la-palabra-clave-ref" />
		<meta property="og:image" content="https://www.developerro.com/assets/apple-touch-icon-144-precomposed.png" />
		<meta property="og:description" content="No hace mucho, estabamos tomando unas cervezas algunos desarrolladores de .net de Barcelona. Entonces sali&oacute; el tema de los talibanes del c&oacute;digo..." />
		<meta property="og:site_name" content="developerro" />
		<meta property="og:locale" content="es_es" />
		<meta property="article:modified_time" content="2011-12-07 11:45:20Z" />
		<meta property="article:published_time" content="2011-12-07 11:45:20Z" />
		<meta property="article:author" content="Fernando Escolar" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/24/azure-functions-net-5" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/10/efcore-vs-records" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/03/chorra-tip-1-wcd-command" />
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@fernandoescolar" />
		<meta name="twitter:creator" content="@fernandoescolar" />
		<meta name="twitter:title" content="Usando la palabra clave &#8220;ref&#8221;" />
		<meta name="twitter:description" content="No hace mucho, estabamos tomando unas cervezas algunos desarrolladores de .net de Barcelona. Entonces sali&oacute; el tema de los talibanes del c&oacute;digo..." />
		<meta name="twitter:image" content="https://www.developerro.com/assets/apple-touch-icon-144-precomposed.png" />
		<meta name="twitter:url" content="https://www.developerro.com/2011/12/07/usando-la-palabra-clave-ref" />
		<meta name="description" content="No hace mucho, estabamos tomando unas cervezas algunos desarrolladores de .net de Barcelona. Entonces sali&oacute; el tema de los talibanes del c&oacute;digo..." />
		<link rel="alternate" type="application/atom+xml" title="Developerro" href="/atom.xml" />
		<link rel="canonical" href="https://www.developerro.com/2011/12/07/usando-la-palabra-clave-ref" />
		<!-- Icons -->
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png" />
		<link rel="shortcut icon" href="/assets/favicon.ico" />
		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="Developerro" href="/atom.xml" />
		<!-- Styles -->
		<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" type="text/css" />
		<link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css" />
		<link rel="stylesheet" href="/assets/main.css" />
		<link rel="stylesheet" href="/assets/syntax.css" />
		<!-- Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163390000-1">
		</script>
		<script>
			
			    function activateGoogleAnalytics() {
			        window.dataLayer = window.dataLayer || [];
			        function gtag(){dataLayer.push(arguments);}
			        gtag('js', new Date());
			        gtag('config', 'UA-163390000-1');
			    }
			
		</script>
	</head>
	<body>
		<nav>
			<i id="hamburger">
			</i> <a href="/">
				<b>
					d</b>eveloperro
			</a>
			<ul>
				<li>
					<a href="/posts">blog
					</a>
				</li>
				<li>
					<a href="/about">
						acerca de
					</a>
				</li>
				<li>
					<a href="/archive">
						archivo
					</a>
				</li>
				<li>
					<a href="/projects">
						oss
					</a>
				</li>
				<li>
					<a href="/search">
						buscar
					</a>
				</li>
				<li>
					<a href="/videos">
						vídeos
					</a>
				</li>
			</ul>
		</nav>
		<header class="post">
			<h1>
				Usando la palabra clave “ref”
			</h1><small>07 dic. 2011 · 7 min. de lectura
			</small>
		</header>
		<article class="post">
			<p>
				No hace mucho, estabamos tomando unas cervezas algunos desarrolladores de .net de Barcelona. Entonces salió el tema de los talibanes del código. Cosas como <em>fxCop
				</em> o <em>styleCop
				</em>. Aunque estas herramientas y sus reglas dan para varios artículos de debate, el caso es que surgió una norma del<strong> code analysis
				</strong> (<em>fxCop
				</em>) que recomienda no usar la palabra en clave "<em>ref
				</em>".
			</p>
			<!--break-->
			<p>
				En ese momento varios afirmamos que estaba bien porque no era necesario, al menos con objetos. Entonces uno de los comensales, <strong>Jaume Jornet
				</strong> (@jaumejornet) rapidamente respondió con un "<em>es un doble-asterísco de c
				</em>". A partir de ahí ya le habíamos comprado la respuesta, pero puso un ejemplo rápido usando un dibujo del <strong>heap
				</strong> y otro del <strong>stack
				</strong>, que para las personas que siempre han usado lenguajes manejados puede resultar muy útil.
			</p>
			<p>
				Como es un tema muy interesante, vamos a intentar ampliar la explicación que nos dió de Jaume y comentar el uso de la palabra en clave <em>ref.
				</em>
			</p>
			<p>
				Antes de empezar vamos a explicar vagamente qué es la stack y qué el heap:
			</p>
			<ul>
				<li>
					<strong>
						Stack
					</strong>: es la pila. Una sección de memoria secuencial (<strong>L
					</strong>ast <strong>I
					</strong>n <strong>F
					</strong>irst<strong> O
					</strong>ut) y de acceso rápido. Ahí se almacenarán estructuras (struct, int, long, bool ...) y punteros a datos más complejos que se almacenan en heap o a la propia stack. Una pila tiene un tamaño fijo y es de acceso rápido.
				</li>
				<li>
					<strong>
						Heap
					</strong>: es la memoria como comunmente la conocemos. Puede crecer según las necesidades, es de acceso aleatorio (no sabemos cuanto tardará en realizar la operacion). Aquí se almacenan los objetos y datos complejos.
				</li>
			</ul>
			<p>
				Esta descripción quizá no sea la más exacta y tampoco la que más aclara. Así que vamos a ver un ejemplo:
			</p>
			<pre class="brush: c#">public class Person
{
   public string Name { get; set; }
   public int Age { get; set; }
}</pre>
			<pre class="brush: c#">int a = 3;
long b = 4;
var c = new Person();</pre>
			<p>
				En el momento de ejecutar ese código, quedaría así almacenado (en azul stack y en rojo heap):
			</p>
			<center>
				<img src="/assets/uploads/2012/09/stack1.png" alt="" width="312" height="134" />
			</center>
			<p>
				Para los que no vienen de lenguajes como <em>c
				</em> o <em>c++
				</em>, cuando vemos el símbolo asterisco delante del nombre de una variable significa que es donde se almacena la dirección de memoria (el lugar en el heap) del objeto. Pero el objeto verdaderamente no está ahí. Solo es una referencia a la zona del heap donde está almacenado. Un <strong>puntero
				</strong>.
			</p>
			<p>
				Ahora declaramos una función de esta forma:
			</p>
			<pre class="brush: c#">public void Method1(int i, Person p)
{
   i = 12;
   p.Name = "Fernando";
}

				<p>
					Method1(a, c);
				</p></pre>
			<p>
				Esta función cuando es llamada genera dos nuevas entradas en la stack, una de tipo entero (int) con el valor de 'a' copiado y otra de tipo puntero a persona con la misma dirección de memoria que la anterior:
			</p>
			<center>
				<img src="/assets/uploads/2012/09/stack2.png" alt="" width="312" height="170" />
			</center>
			<p>
				Entonces vemos que si dentro de la función cambiamos el valor del entero, este es una copia y se cambia en la pila (stack). Pero si cambiamos el valor del nombre de la persona, aunque el puntero sea una copia, referencia la misma dirección de memoria que la variable '<em>c
				</em>'.
			</p>
			<center>
				<img src="/assets/uploads/2012/09/stack3.png" alt="" width="312" height="170" />
			</center>
			<p>
				Por esta razón, cuando termine la ejecución del método, la variable '<em>a
				</em>' seguirá valiendo <em>3
				</em>, pero el nombre de '<em>c
				</em>' será "<em>Fernando
				</em>". Y de aquí viene ese dicho que reza: que en c# (y otros lenguajes manejados) los objetos se pasan siempre por referencia. Porque lo cierto es que se copia la referencia (o dirección en el heap) de ese objeto en la pila.
			</p>
			<p>
				Si queremos cambar el valor del entero, tendremos que pasarlo por referencia, usando la palabra en clave <em>ref
				</em>:
			</p>
			<pre class="brush: c#">public void Method2(ref int i, Person p)
{
   i = 12;
   p.Name = "Fernando";
}

				<p>
					Method2(ref a, c);
				</p></pre>
			<p>
				Al escribir la palabra <i>ref
				</i>, la variable que se crea en la pila, en lugar de ser un entero, será una referencia (un puntero) a la dirección de la pila donde se encuentra el entero original. Y su ejecución causaría esto:
			</p>
			<center>
				<img src="/assets/uploads/2012/09/stack4.png" alt="" width="312" height="170" />
			</center>
			<p>
				Como antes hemos dicho que el objeto '<em>p
				</em>' ya se pasaba por referencia sin necesitad del comando <em>ref
				</em>, ¿qué pasaría si lo reasignamos a un nuevo valor?
			</p>
			<pre class="brush: c#">public void Method3(ref int i, Person p)
{
   i = 12;
   p.Name = "fernando";
   p = new Person();
   p.Name = "pablo";
}

				<p>
					Method3(ref a, c);
				</p></pre>
			<p>
				En este contexto el objeto '<em>p
				</em>' es una copia de la dirección de memoria del objeto '<em>c
				</em>' original. Y al asignarle una nueva instancia, se cambia la dirección de memoria y genera un nuevo bloque en el <em>heap
				</em>. Pero el objeto '<em>c
				</em>' permanece apuntando al original:
			</p>
			<center>
				<img src="/assets/uploads/2012/09/stack5.png" alt="" width="312" height="170" />
			</center>
			<p>
				Así pues llegamos al último punto, ¿qué pasaría si quisieramos cambiar la instancia original? Entonces tendríamos que crear el famoso doble-puntero. O lo que es lo mismo, una referencia del objeto <em>Person
				</em>:
			</p>
			<pre class="brush: c#">public void Method4(int i, ref Person p)
{
   p = new Person();
   p.Name = "pablo";
}

				<p>
					Method4(a, ref c);
				</p></pre>
			<p>
				Así al salir del método cuarto, el valor de '<em>c
				</em>' sería la dirección de memoria del nuevo objeto person con nombre "<em>pablo
				</em>":
			</p>
			<center>
				<img src="/assets/uploads/2012/09/stack6.png" alt="" width="312" height="170" />
			</center>
			<p>
				Ahora os invito a que hagaís estas pruebas y observeís por vosotros mismos este comportamiento.
			</p>
		</article>
		<section id="share">
			<a href="https://twitter.com/intent/tweet?text=Usando la palabra clave &#8220;ref&#8221;&url=https://www.developerro.com/2011/12/07/usando-la-palabra-clave-ref" rel="nofollow" target="_blank" title="Share on Twitter">
				<i class="fab fa-twitter">
				</i>
			</a> <a href="https://facebook.com/sharer.php?u=https://www.developerro.com/2011/12/07/usando-la-palabra-clave-ref" rel="nofollow" target="_blank" title="Share on Facebook">
				<i class="fab fa-facebook"></i>
			</a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.developerro.com/2011/12/07/usando-la-palabra-clave-ref" rel="nofollow" target="_blank" title="Share on Linkedlin">
				<i class="fab fa-linkedin"></i>
			</a> <a href="http://www.reddit.com/submit?url=https://www.developerro.com/2011/12/07/usando-la-palabra-clave-ref" rel="nofollow" target="_blank" title="Share on Reddit">
				<i class="fab fa-reddit"></i>
			</a> <a href="https://www.buymeacoffee.com/fernandoescolar" rel="nofollow" target="_blank" title="Buy me a beer">
				<i class="fa fa-beer"></i> buy me a beer
			</a>
		</section>
		<section id="related">
			<h2>
				Relacionado (o no)
			</h2>
			<ul>
				<li>
					<a href="/2021/03/24/azure-functions-net-5">
						Azure Functions con .NET 5
					</a> <small>24 mar. 2021
					</small>
				</li>
				<li>
					<a href="/2021/03/10/efcore-vs-records">
						EF Core vs. Records
					</a> <small>10 mar. 2021
					</small>
				</li>
				<li>
					<a href="/2021/03/03/chorra-tip-1-wcd-command">
						ChorraTip: rutas windows en git bash
					</a> <small>03 mar. 2021
					</small>
				</li>
				<li>
					<a href="/video/2021/02/27/raiders-od-the-lost-leak">
						Raiders of the lost leak
					</a> <small>27 feb. 2021
					</small>
				</li>
				<li>
					<a href="/video/2020/12/09/net-5-just-talking">
						.Net 5 Just Talking
					</a> <small>09 dic. 2020
					</small>
				</li>
			</ul>
		</section>
		<footer>
			<ul>
				<li>
					<a href="mailto:fer.escolar@gmail.com" target="_blank">
						<i class="far fa-envelope">
						</i>
					</a>
				</li>
				<li>
					<a href="https://twitter.com/fernandoescolar" target="_blank">
						<i class="fab fa-twitter">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.linkedin.com/in/fernandoescolar" target="_blank">
						<i class="fab fa-linkedin">
						</i>
					</a>
				</li>
				<li>
					<a href="https://github.com/fernandoescolar" target="_blank">
						<i class="fab fa-github">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.buymeacoffee.com/fernandoescolar" target="_blank">
						<i class="fa fa-beer">
						</i>
					</a>
				</li>
			</ul><a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">
				<img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
			</a>
		</footer>
		<dialog id="cookie-notice">
			Nos gustaría usar cookies de terceros para hacer este sitio mejor. <a id="cookie-notice-accept">vale
			</a>
		</dialog>
		<script src="/assets/scripts.js">
		</script>
	</body>
</html>