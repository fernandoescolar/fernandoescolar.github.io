<!DOCTYPE html>
<html lang="es-es">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<title>
			Azure Functions con docker · developerro
		</title>
		<!-- Social Metas -->
		<meta name="description" content="Docker y los containers son a la programaci&#243;n, lo que el rebozado y empanado a la cocina tradicional. Si bien a&#241;ade un paso extra que ensucia y a veces se ha..." />
		<meta property="og:title" content="Azure Functions con docker" />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://www.developerro.com/2019/03/26/azure-functions-docker" />
		<meta property="og:image" content="https://www.developerro.com/assets/uploads/bg/containers.jpg" />
		<meta property="og:description" content="Docker y los containers son a la programación, lo que el rebozado y empanado a la cocina tradicional. Si bien añade un paso extra que ensucia y a veces se ha..." />
		<meta property="og:site_name" content="developerro" />
		<meta property="og:locale" content="es_es" />
		<meta property="article:modified_time" content="2019-03-26 07:35:02Z" />
		<meta property="article:published_time" content="2019-03-26 07:35:02Z" />
		<meta property="article:author" content="Fernando Escolar" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/24/azure-functions-net-5" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/10/efcore-vs-records" />
		<meta property="og:see_also" content="https://www.developerro.com/2021/03/03/chorra-tip-1-wcd-command" />
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@fernandoescolar" />
		<meta name="twitter:creator" content="@fernandoescolar" />
		<meta name="twitter:title" content="Azure Functions con docker" />
		<meta name="twitter:description" content="Docker y los containers son a la programación, lo que el rebozado y empanado a la cocina tradicional. Si bien añade un paso extra que ensucia y a veces se ha..." />
		<meta name="twitter:image" content="https://www.developerro.com/assets/uploads/bg/containers.jpg" />
		<meta name="twitter:url" content="https://www.developerro.com/2019/03/26/azure-functions-docker" />
		<meta name="description" content="Docker y los containers son a la programación, lo que el rebozado y empanado a la cocina tradicional. Si bien añade un paso extra que ensucia y a veces se ha..." />
		<link rel="alternate" type="application/atom+xml" title="Developerro" href="/atom.xml" />
		<link rel="canonical" href="https://www.developerro.com/2019/03/26/azure-functions-docker" />
		<!-- Icons -->
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png" />
		<link rel="shortcut icon" href="/assets/favicon.ico" />
		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="Developerro" href="/atom.xml" />
		<!-- Styles -->
		<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" type="text/css" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" type="text/css" />
		<link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css" />
		<link rel="stylesheet" href="/assets/main.css" />
		<link rel="stylesheet" href="/assets/syntax.css" />
		<!-- Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163390000-1">
		</script>
		<script>
			
			    function activateGoogleAnalytics() {
			        window.dataLayer = window.dataLayer || [];
			        function gtag(){dataLayer.push(arguments);}
			        gtag('js', new Date());
			        gtag('config', 'UA-163390000-1');
			    }
			
		</script>
		<style>
			
			    header { background: linear-gradient(to bottom, rgba(228, 225, 216, 0.95) 0%, rgba(172, 65, 66, 0.55) 100%), url(/assets/uploads/bg/containers.jpg) center / cover; }
			  
		</style>
	</head>
	<body>
		<nav>
			<i id="hamburger">
			</i> <a href="/">
				<b>
					d</b>eveloperro
			</a>
			<ul>
				<li>
					<a href="/posts">blog
					</a>
				</li>
				<li>
					<a href="/about">
						acerca de
					</a>
				</li>
				<li>
					<a href="/archive">
						archivo
					</a>
				</li>
				<li>
					<a href="/projects">
						oss
					</a>
				</li>
				<li>
					<a href="/search">
						buscar
					</a>
				</li>
				<li>
					<a href="/videos">
						vídeos
					</a>
				</li>
			</ul>
		</nav>
		<header class="post">
			<h1>
				Azure Functions con docker
			</h1><small>26 mar. 2019 · 7 min. de lectura
			</small>
		</header>
		<article class="post">
			<p>
				Docker y los containers son a la programación, lo que el rebozado y empanado a la cocina tradicional. Si bien añade un paso extra que ensucia y a veces se hace un poco difícil, después puedes transportar la comida con mucha facilidad, sin romperla, y además te resulta muy fácil de comer. Y no nos engañemos, está claro que a todo el mundo le gustan las croquetas
				<!--break-->
				.
			</p>
			<p>
				Si has llegado hasta aquí es posible que quieras hacer pechugas a la villaroy o una imagen de docker con tus Azure Functions dentro, nunca se sabe lo que puede pasar con las inteligencias artificiales hoy en día. De cualquier forma, estás en el lugar correcto: para lo primero necesitaremos pan rallado, huevo, bechamel y pechugas de pollo, y para lo segundo, docker, un proyecto de Azure Functions y 5 minutos de tu vida.
			</p>
			<p>
				Aquí os vamos a exponer dos recetas, pero lo más recomendable es que mezcléis cosas de una y de otra:
			</p>
			<h2 id="receta-1">
				Receta 1
			</h2>
			<p>
				La primera receta es más a mano. Vamos a empezar desde hacer la bechamel, hasta acabar friendo las pechugas. Eso no quiere decir que vayan a ser unos pasos difíciles:
			</p>
			<h3 id="preparando-la-bechamel">
				Preparando la bechamel
			</h3>
			<p>
				Cogemos un cazó y calentamos leche. Metemos harina, mantequilla, mantenemos a fuego bajo, revolvemos y rezamos para que no nos salgan grumos.
			</p>
			<p>
				En el caso de las Azure Functions necesitaremos tener instalado inicialmente <a href="https://www.npmjs.com/get-npm">npm
				</a>, <a href="https://dotnet.microsoft.com/download/dotnet-core">dotnet sdk
				</a> y <a href="https://docs.docker.com/install/">docker
				</a>.
			</p>
			<p>
				Después instalaremos una tool de Azure Functions que nos permitirá crear nuestro proyecto:
			</p>
			<pre class="language-bash highlight">
<code>npm i -g azure-functions-core-tools
				</code>
</pre>
			<p>
				Ahora podremos crear nuestro primer proyecto directamente con soporte para docker:
			</p>
			<pre class="language-bash highlight">
<code>$ func init . --docker
Select a worker runtime:
1. dotnet
2. node
3. python (preview)
Choose option: 1
dotnet

Writing /Users/fernandoescolar/projects/functions-docker/.vscode/extensions.json
Writing Dockerfile
				</code>
</pre>
			<p>
				Una vez tenemos el proyecto, añadimos nuestra primera Function:
			</p>
			<pre class="language-bash highlight">
<code>$ func new
Select a template:
1. QueueTrigger
2. HttpTrigger
3. BlobTrigger
4. TimerTrigger
5. DurableFunctionsOrchestration
6. SendGrid
7. EventHubTrigger
8. ServiceBusQueueTrigger
9. ServiceBusTopicTrigger
10. EventGridTrigger
11. CosmosDBTrigger
12. IotHubTrigger
Choose option: 2
Function name: Hello
Hello

The function "Hello" was created successfully from the "HttpTrigger" template.
				</code>
</pre>
			<h3 id="empanando-las-pechugas">
				Empanando las pechugas
			</h3>
			<p>
				Rebozar es una tarea simple, sucia y tediosa. Las pechugas ya forman una unidad con la bechamel. Ahora batimos unos huevos en un plato, mientras que en otro ponemos pan rallado. Entonces, cogemos una a una las pechugas con bechamel y las bañamos en el plato de huevo, para acto seguido pasarlas por el de pan rallado. Si lo hacemos bien, tendremos un preparado perfecto, listo para cocinar.
			</p>
			<p>
				Por otro lado, si queremos hacer una imagen de docker con nuestras Functions, lo primero que haremos para poder probarlas es ponerles un acceso público. Para ello, abrimos el archivo "Hello.cs" y sustituimos el <code>AuthorizationLevel.Function
				</code> por <code>AuthorizationLevel.Anonymous
				</code>.
			</p>
			<h3 id="friendo">
				Friendo
			</h3>
			<p>
				Podríamos decir que solo tenemos que echar aceite a una sartén, esperar a que se caliente e ir pasando las pechugas hasta que consideremos que están bien hechas. Pero freír es un arte. Es como pintar un bello retrato o componer la más deliciosa de las sinfonías. Solo el talento y la práctica nos llevará a tener unos resultados excelentes.
			</p>
			<p>
				Mientras que generar una imagen de docker cuando ya tienes el "Dockerfile" hecho, es bastante fácil. Basta con ejecutar el comando <code>build
				</code>:
			</p>
			<pre class="language-bash highlight">
<code>$ docker build -t azurefunctionsdemo .
Step 1/6 : FROM microsoft/dotnet:2.1-sdk AS installer-env
Step 2/6 : COPY . /src/dotnet-function-app
Step 3/6 : RUN cd /src/dotnet-function-app &&     mkdir -p /home/site/wwwroot &&     dotnet publish *.csproj --output /home/site/wwwroot
Step 4/6 : FROM mcr.microsoft.com/azure-functions/dotnet:2.0
Step 5/6 : ENV AzureWebJobsScriptRoot=/home/site/wwwroot
Step 6/6 : COPY --from=installer-env ["/home/site/wwwroot", "/home/site/wwwroot"]
Successfully tagged azurefunctionsdemo:latest
				</code>
</pre>
			<h3 id="comiendo">
				Comiendo
			</h3>
			<p>
				La mejor parte de hacer unas pechugas a la villaroy es comérselas. Con cuchillo y tenedor, con la mano... da igual. Si sobra (que no creo), lo suyo es guardarlas en un tupperware para comerlas mañana o pasado.
			</p>
			<p>
				En cuanto una imagen de docker, si queremos ejecutarla localmente, hay que lanzar el comando <code>run
				</code> exponiendo el puerto 80 en el 8080 local:
			</p>
			<pre class="language-bash highlight">
<code>$ docker run -p 8080:80 azurefunctionsdemo
Hosting environment: Production
Content root path: /
Now listening on: http://[::]:80
Application started. Press Ctrl+C to shut down.
				</code>
</pre>
			<p>
				Y podremos comprobar que ha funcionado visitando la url: <a href="http://localhost:8080/api/hello?name=Chimo%20Bayo">http://localhost:8080/api/hello?name=Chimo%20Bayo
				</a>.
			</p>
			<p>
				Si lo que queremos es coger esa imagen y realizar un deploy a kubernetes, las tools que instalamos al inicio nos ayudarán:
			</p>
			<pre class="language-bash highlight">
<code>func deploy --platform kubernetes --name azurefunctionsdemo --registry 
					<docker-hub-id or registry-server>
						--pull-secret 
						<registry auth secret>
							--min 3 --max 10
						</registry></docker-hub-id>
				</code>
</pre>
			<p>
				Un poquito de perejil y ¡para el clúster!
			</p>
			<p>
				<img src="/assets/uploads/2019/03/arguinano-gafas.jpg" alt="Arguiñano con gafas " fuckyou />
			</p>
			<h2 id="receta-2">
				Receta 2
			</h2>
			<p>
				Esta es la receta más sencilla, con unos resultados excelentes con poco esfuerzo:
			</p>
			<h3 id="ir-al-corte-ingles-y-comprarlas-hechas">
				Ir al corte inglés y comprarlas hechas
			</h3>
			<p>
				Hace un tiempo, paseando por el supermercado del corte inglés descubrí que hay un puesto fuera con comida ya cocinada. Si vas antes de las 12 (después de esa hora no puedo garantizaros nada), tienen unas pechugas a la villaroy que están riquísimas. Casi como las de mi madre. Pero en esta vez, no habremos tenido que ensuciar nada, solo meterlas al microondas.
			</p>
			<p>
				En el caso de docker y las Azure Functions, también tenemos una tienda donde podremos adquirir todo lo que necesitemos.
			</p>
			<p>
				Si echamos un vistazo a <a href="https://hub.docker.com/_/microsoft-azure-functions-base">Azure Functions Base en el Hub de docker
				</a> encontraremos diferentes imágenes base en dependencia de la plataforma y lenguajes de programación que usemos.
			</p>
			<p>
				Desde ahí, encontraremos enlaces al <a href="https://github.com/Azure/azure-functions-docker">repositorio de GitHub de Azure Functions Docker
				</a>.
			</p>
			<p>
				En este repositorio podremos encontrar los ejemplos de "Dockerfile" para muchos casos de uso y para lenguajes de programación como node, c#, python o powershell. Además de una serie de archivos ".yml" que nos ayudarán a automatizar la integración continua de nuestros contenedores en Hubs privados de Azure.
			</p>
			<p>
				Una mina de oro.
			</p>
			<h2 id="conclusiones">
				Conclusiones
			</h2>
			<p>
				A mi me gustan mucho las pechugas a la villaroy y también la propuesta de containers de docker con Azure Functions. Ambas cosas son sencillas de conseguir, aunque tener maestría requiere práctica y tiempo.
			</p>
			<p>
				<img src="/assets/uploads/2019/03/arguinano-end.jpg" alt="Rico, rico y con fundamento" />
			</p>
		</article>
		<section id="share">
			<a href="https://twitter.com/intent/tweet?text=Azure Functions con docker&url=https://www.developerro.com/2019/03/26/azure-functions-docker" rel="nofollow" target="_blank" title="Share on Twitter">
				<i class="fab fa-twitter">
				</i>
			</a> <a href="https://facebook.com/sharer.php?u=https://www.developerro.com/2019/03/26/azure-functions-docker" rel="nofollow" target="_blank" title="Share on Facebook">
				<i class="fab fa-facebook"></i>
			</a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.developerro.com/2019/03/26/azure-functions-docker" rel="nofollow" target="_blank" title="Share on Linkedlin">
				<i class="fab fa-linkedin"></i>
			</a> <a href="http://www.reddit.com/submit?url=https://www.developerro.com/2019/03/26/azure-functions-docker" rel="nofollow" target="_blank" title="Share on Reddit">
				<i class="fab fa-reddit"></i>
			</a> <a href="https://www.buymeacoffee.com/fernandoescolar" rel="nofollow" target="_blank" title="Buy me a beer">
				<i class="fa fa-beer"></i> buy me a beer
			</a>
		</section>
		<section id="related">
			<h2>
				Relacionado (o no)
			</h2>
			<ul>
				<li>
					<a href="/2021/03/24/azure-functions-net-5">
						Azure Functions con .NET 5
					</a> <small>24 mar. 2021
					</small>
				</li>
				<li>
					<a href="/2019/05/02/azure-functions-custom-triggers">
						Azure Functions: custom triggers
					</a> <small>02 may. 2019
					</small>
				</li>
				<li>
					<a href="/2019/04/23/azure-functions-custom-in-bindings">
						Azure Functions: custom in bindings
					</a> <small>23 abr. 2019
					</small>
				</li>
				<li>
					<a href="/2019/04/15/azure-functions-custom-out-bindings">
						Azure Functions: custom out bindings
					</a> <small>15 abr. 2019
					</small>
				</li>
				<li>
					<a href="/2019/02/12/azure-functions-typescript">
						Azure Functions con TypeScript
					</a> <small>12 feb. 2019
					</small>
				</li>
			</ul>
		</section>
		<footer>
			<ul>
				<li>
					<a href="mailto:fer.escolar@gmail.com" target="_blank">
						<i class="far fa-envelope">
						</i>
					</a>
				</li>
				<li>
					<a href="https://twitter.com/fernandoescolar" target="_blank">
						<i class="fab fa-twitter">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.linkedin.com/in/fernandoescolar" target="_blank">
						<i class="fab fa-linkedin">
						</i>
					</a>
				</li>
				<li>
					<a href="https://github.com/fernandoescolar" target="_blank">
						<i class="fab fa-github">
						</i>
					</a>
				</li>
				<li>
					<a href="https://www.buymeacoffee.com/fernandoescolar" target="_blank">
						<i class="fa fa-beer">
						</i>
					</a>
				</li>
			</ul><a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">
				<img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
			</a>
		</footer>
		<dialog id="cookie-notice">
			Nos gustaría usar cookies de terceros para hacer este sitio mejor. <a id="cookie-notice-accept">vale
			</a>
		</dialog>
		<script src="/assets/scripts.js">
		</script>
	</body>
</html>